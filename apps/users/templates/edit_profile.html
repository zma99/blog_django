{% extends 'base.html' %}

{% load static %}

{% block title %}Editar perfil{% endblock %}

{% block content %}
{% if messages %}
  <div class="mb-4">
    {% for message in messages %}
      <div class="px-4 py-2 rounded-md shadow-sm
        {% if message.tags == 'success' %}
          bg-green-100 text-green-800 border border-green-300
        {% elif message.tags == 'error' %}
          bg-red-100 text-red-800 border border-red-300
        {% elif message.tags == 'warning' %}
          bg-yellow-100 text-yellow-800 border border-yellow-300
        {% else %}
          bg-gray-100 text-gray-800 border border-gray-300
        {% endif %}
      ">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}
<div class="max-w-xl mx-auto mt-10 bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">Editar perfil</h2>

    <form method="POST" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        {% if form.non_field_errors %}
        <div class="text-red-600 text-sm">
            {{ form.non_field_errors }}
        </div>
        {% endif %}

        <div class="flex flex-col items-center mb-4">
            <img id="avatar-preview" src="{{ user.profile.avatar.url|default:'' }}" alt="Avatar actual"
                class="w-32 h-32 rounded-full object-cover border-4 border-gray-300 shadow-md">

            <button type="button" id="discard-avatar" class="mt-2 text-sm text-red-600 hover:underline hidden">
                Descartar avatar
            </button>
        </div>


        <div>
            <label for="id_avatar" class="block text-sm font-medium text-gray-700 mb-1">
                Foto de perfil
            </label>

            <label for="id_avatar"
                class="inline-block bg-gray-100 border border-gray-300 px-4 py-2 rounded cursor-pointer hover:bg-gray-200 text-sm text-gray-700">
                Seleccionar imagen
            </label>
            <input type="file" name="avatar" id="id_avatar" class="hidden">

            <div>
                <label for="{{ form.username.id_for_label }}" class="block text-sm font-medium text-gray-700 mt-3 mb-1">
                    {{ form.username.label }} 
                </label>
                {{ form.username }}
                <span class="text-xs text-gray-500 italic">(No se puede editar este campo)</span>
            </div>
            
            <div>
                <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 mt-3 mb-1">
                    {{ form.email.label }}
                </label>
                {{ form.email }}
                <span class="text-xs text-gray-500 italic">(No se puede editar este campo)</span>
            </div>


            <div>
                <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mt-3 mb-1">
                    {{ form.first_name.label }}
                </label>
                {{ form.first_name }}
                {% if form.first_name.errors %}
                <p class="text-red-500 text-xs mt-1">{{ form.first_name.errors.0 }}</p>
                {% endif %}
            </div>

            <div>
                <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mt-3 mb-1">
                    {{ form.last_name.label }}
                </label>
                {{ form.last_name }}
                {% if form.last_name.errors %}
                <p class="text-red-500 text-xs mt-1">{{ form.last_name.errors.0 }}</p>
                {% endif %}
            </div>

            {% if form.avatar.errors %}
            <p class="text-red-500 text-xs mt-1">{{ form.avatar.errors.0 }}</p>
            {% endif %}
        </div>



        <div class="flex items-center space-x-2">
            {{ form.requested_editor }}
            <label for="{{ form.requested_editor.id_for_label }}" class="text-sm text-gray-700">
                {{ form.requested_editor.label }}
            </label>
        </div>
        {% if form.requested_editor.errors %}
        <p class="text-red-500 text-xs mt-1">{{ form.requested_editor.errors.0 }}</p>
        {% endif %}

        <div class="text-center">
            <a href="{% url 'profile_view' %}" type="button"
                class="inline-block bg-gray-600 hover:bg-gray-700 text-white font-semibold px-6 py-2 rounded-md transition">
                Cancelar
            </a>
            <button type="submit"
                class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded-md transition">
                Guardar cambios
            </button>
        </div>
    </form>
</div>
<script src="{% static 'js/profile_photo_preview.js' %}"></script>


{% endblock %}